<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ¶ ä¸€åˆä¸€ä¼š</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #f5f6f8;
  color: #333;
}
header {
  background: #fff;
  padding: 16px;
  font-size: 20px;
  font-weight: bold;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}
main {
  max-width: 640px;
  margin: auto;
  padding: 16px;
}
.card {
  background: #fff;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}
label {
  display: block;
  margin-top: 12px;
  font-weight: bold;
}
input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
button {
  width: 100%;
  margin-top: 16px;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  background: #2d7ff9;
  color: #fff;
}
.log {
  background: #fafafa;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 12px;
}
.log img {
  width: 100%;
  border-radius: 8px;
  margin-top: 8px;
}
small {
  color: #666;
}
</style>
</head>

<body>
<header>ğŸ¶ ä¸€åˆä¸€ä¼š</header>

<main>

<div class="card">
  <label>ğŸ“¸ æ—¥æœ¬é…’ãƒ©ãƒ™ãƒ«</label>
  <input type="file" id="imageInput" accept="image/*">

  <label>ğŸ¶ æ—¥æœ¬é…’å</label>
  <input type="text" id="name">

  <label>ğŸ“… é–‹å°å¾Œ ä½•æ—¥ç›®ï¼Ÿ</label>
  <select id="openedDays">
    <option value="0">é–‹å°ç›´å¾Œ</option>
    <option value="1">1æ—¥</option>
    <option value="2">2æ—¥</option>
    <option value="3">3æ—¥</option>
    <option value="4">4æ—¥ä»¥ä¸Š</option>
  </select>

  <label>â“ ã¾ãŸé£²ã¿ãŸã„ï¼Ÿ</label>
  <select id="like">
    <option value="1">ã‚‚ã†é£²ã¾ãªã„</option>
    <option value="2">å¾®å¦™</option>
    <option value="3" selected>æ™®é€š</option>
    <option value="4">ã¾ãŸé£²ã¿ãŸã„</option>
    <option value="5">çµ¶å¯¾ã¾ãŸé£²ã‚€</option>
  </select>

  <label>ğŸ¬ å°è±¡ã¯ï¼Ÿï¼ˆç”˜è¾›ã§ã¯ãªãï¼‰</label>
  <select id="impression">
    <option value="-1">ã‚­ãƒ¬ãŒã‚ã‚‹</option>
    <option value="0" selected>ãƒãƒ©ãƒ³ã‚¹å‹</option>
    <option value="1">ãµãã‚ˆã‹</option>
  </select>

  <button onclick="save()">è¨˜éŒ²ã™ã‚‹</button>
</div>

<div class="card">
  <h3>ğŸ“– è¨˜éŒ²ä¸€è¦§</h3>
  <div id="logs"></div>
</div>

</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ğŸ”¥ Firebaseè¨­å®šï¼ˆã“ã“ã‚’æ›¸ãæ›ãˆã‚‹ï¼‰ */
const firebaseConfig = {
  apiKey: "AIzaSyAxxxxx",
  authDomain: "ichigo-ichie-f4c9c.firebaseapp.com",
  databaseURL: "https://ichigo-ichie-f4c9c-default-rtdb.firebaseio.com",
  projectId: "ichigo-ichie-f4c9c"
};

  apiKey: "YOUR_API_KEY",
  authDomain: "xxxx.firebaseapp.com",
  databaseURL: "https://xxxx.firebasedatabase.app",
  projectId: "xxxx"
};

firebase.initializeApp(firebaseConfig);
firebase.auth().signInAnonymously();

const db = firebase.database();

let currentUID = null;
firebase.auth().onAuthStateChanged(user => {
  if (user) {
    currentUID = user.uid;
    loadLogs();
  }
});

/* ç”»åƒã‚’åœ§ç¸®ã—ã¦Base64åŒ– */
function compressImage(file, callback) {
  const img = new Image();
  const reader = new FileReader();
  reader.onload = e => img.src = e.target.result;
  img.onload = () => {
    const canvas = document.createElement("canvas");
    const max = 800;
    let w = img.width, h = img.height;
    if (w > h && w > max) { h *= max / w; w = max; }
    else if (h > max) { w *= max / h; h = max; }
    canvas.width = w;
    canvas.height = h;
    canvas.getContext("2d").drawImage(img, 0, 0, w, h);
    callback(canvas.toDataURL("image/webp", 0.6));
  };
  reader.readAsDataURL(file);
}

function save() {
  const file = imageInput.files[0];
  if (!file || !currentUID) return alert("ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„");

  compressImage(file, imageData => {
    const ref = db.ref("users/" + currentUID + "/logs").push();
    ref.set({
      name: name.value || "åç§°æœªè¨˜éŒ²",
      openedDays: openedDays.value,
      like: like.value,
      impression: impression.value,
      image: imageData,
      date: new Date().toLocaleDateString()
    });
  });
}

function loadLogs() {
  db.ref("users/" + currentUID + "/logs").on("value", snap => {
    logs.innerHTML = "";
    snap.forEach(s => {
      const l = s.val();
      const div = document.createElement("div");
      div.className = "log";
      div.innerHTML = `
        <strong>${l.name}</strong><br>
        â­ï¸ ${l.like} / 5ã€€
        ğŸ“… é–‹å° ${l.openedDays} æ—¥ç›®<br>
        ğŸ¬ ${["ã‚­ãƒ¬","ãƒãƒ©ãƒ³ã‚¹","ãµãã‚ˆã‹"][Number(l.impression)+1]}<br>
        <small>${l.date}</small>
        <img src="${l.image}">
      `;
      logs.prepend(div);
    });
  });
}
</script>

</body>
</html>
